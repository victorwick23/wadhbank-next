import { Prisma } from '.prisma/client'
import Head from 'next/head'
import { useState } from 'react';
import prisma from '../lib/prisma';
import styles from '../styles/Home.module.css'
import { fetcher } from '../utils/fetcher';


export async function getServerSideProps() {
  const users: Prisma.UserUncheckedCreateInput[] = await prisma.user.findMany();

  return{
    props : {initialUsers : users},
  }
}

export function formatDate(string){
  var options = { year: 'numeric', month: 'long', day: 'numeric' };
  return new Date(string).toLocaleDateString([]);
}

export default function Home({initialUsers}) {
  const [users, setUsers] = useState<Prisma.UserUncheckedCreateInput[]>(initialUsers)
  const [fullName, setFullName]= useState("")
  const [email, setEmail]= useState("")
   

  const formHandle = async (e) => {
    e.preventDefault()
    const body: Prisma.UserCreateInput = {
      fullName,
      email,
    }

    await fetcher("/api/create", {user: body});
    await setUsers([...users, body]); 
    setFullName("")
    setEmail("")
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

     <form onSubmit={formHandle}>
        <div className="flex ">

        </div>
       <input className="bg-white rounded-sm border border-indigo-700" type="text" onChange={(e) => setFullName(e.target.value)} value={fullName} />
       <input className="bg-white rounded-sm border border-indigo-700" type="text" onChange={(e) => setEmail(e.target.value)} value={email } />

      <button>Submit</button>

     </form>

     {users.map((u, index)=>
     <div className="flex" key={index}>
       <p>{u.fullName}| {u.email} | {formatDate(u.dateCreated)}</p>
     </div>
     )}
      
    </div>
  )
}
